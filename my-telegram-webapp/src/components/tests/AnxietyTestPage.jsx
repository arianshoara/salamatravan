import { useState } from "react";
import PropTypes from "prop-types";
import "./DepressionTestPage.css"; // استفاده از همان استایل تست افسردگی

const AnxietyTestPage = ({ onTestComplete }) => {
    const [answers, setAnswers] = useState(Array(7).fill(null));
    const [showResultAnalysis, setShowResultAnalysis] = useState(false);
    const [testResult, setTestResult] = useState(null);

    const questions = [
        {
            "text": "در این دو هفته، چقدر احساس نگرانی و عصبی بودن داشتید؟",
            "options": ["اصلاً نداشتم", "چند روز در هفته", "بیشتر روزها", "تقریباً هر روز"],
            "messages": [
                "اصلاً نداشتم: این پاسخ نشان‌دهنده این است که شما در دو هفته گذشته نگرانی و عصبی بودن را تجربه نکرده‌اید. این وضعیت مطلوب است. **توصیه:** به حفظ روال زندگی سالم خود ادامه دهید.",
                "چند روز در هفته: این پاسخ نشان می‌دهد که شما گاهی اوقات نگرانی و عصبی بودن را تجربه کرده‌اید. این یک تجربه طبیعی انسانی است. **توصیه:** به خودتان اجازه دهید احساسات خود را تجربه کنید و در صورت نیاز از تکنیک‌های مدیریت استرس مانند تنفس عمیق استفاده کنید.",
                "بیشتر روزها: این پاسخ نشان می‌دهد که نگرانی و عصبی بودن به طور مکرر در زندگی شما وجود دارد. این می‌تواند نشانه‌ای از افزایش سطح اضطراب باشد. **توصیه:**  سعی کنید فعالیت‌های آرامش‌بخش مانند یوگا یا مدیتیشن را در برنامه روزانه خود قرار دهید. بررسی کنید که چه عواملی باعث افزایش نگرانی شما می‌شوند.",
                "تقریباً هر روز: این پاسخ نشان می‌دهد که شما به طور مداوم احساس نگرانی و عصبی بودن را تجربه می‌کنید. این می‌تواند نشانه‌ای از اضطراب فراگیر باشد و نیاز به توجه جدی دارد. **توصیه:** توصیه می‌شود برای بررسی دقیق‌تر وضعیت خود و دریافت راهکارهای مناسب، از یک متخصص روانشناس یا مشاور کمک بگیرید."
            ]
        },
        {
            "text": "در این دو هفته، چقدر نتوانستید اضطراب خود را کنترل کنید؟",
            "options": ["اصلاً نداشتم", "چند روز در هفته", "بیشتر روزها", "تقریباً هر روز"],
            "messages": [
                "اصلاً نداشتم: این پاسخ نشان‌دهنده توانایی بالای شما در کنترل اضطراب است. **توصیه:**  به تقویت این مهارت‌ها با تمرین منظم ذهن‌آگاهی ادامه دهید.",
                "چند روز در هفته:  این پاسخ نشان می‌دهد که گاهی اوقات در کنترل اضطراب خود با مشکل مواجه می‌شوید.  **توصیه:** در این مواقع، از روش‌های مقابله‌ای که آموخته‌اید (مانند تکنیک‌های تنفس یا پرت کردن حواس) استفاده کنید.",
                "بیشتر روزها:  این پاسخ نشان می‌دهد که شما اغلب در کنترل اضطراب خود دچار مشکل می‌شوید. **توصیه:**  به دنبال یادگیری تکنیک‌های موثرتر مدیریت اضطراب باشید. شرکت در کارگاه‌های آموزشی مدیریت استرس می‌تواند مفید باشد.",
                "تقریباً هر روز:  این پاسخ نشان می‌دهد که شما به طور مداوم در کنترل اضطراب خود ناتوان هستید. این می‌تواند تاثیر منفی زیادی بر زندگی روزمره شما داشته باشد. **توصیه:** حتماً از یک متخصص بهداشت روان کمک بگیرید تا راهکارهای درمانی مناسب را برای شما تعیین کند."
            ]
        },
        {
            "text": "در این دو هفته، چقدر نگرانی‌هایتان بیش از حد بود؟",
            "options": ["اصلاً نداشتم", "چند روز در هفته", "بیشتر روزها", "تقریباً هر روز"],
            "messages": [
                "اصلاً نداشتم: نگرانی‌های شما در سطح نرمال و متناسب با موقعیت‌ها هستند. **توصیه:**  نگرانی به اندازه نرمال یک واکنش طبیعی است، به این تعادل ادامه دهید.",
                "چند روز در هفته:  گاهی اوقات نگرانی‌های شما از حد معمول فراتر می‌روند. **توصیه:**  سعی کنید در این مواقع با تمرکز بر زمان حال و واقعیت موقعیت، از شدت نگرانی‌ها کم کنید.",
                "بیشتر روزها: بیشتر نگرانی‌های شما غیرمنطقی و بیش از حد هستند. **توصیه:**  به دنبال راهکارهایی برای به چالش کشیدن افکار منفی و غیرمنطقی باشید. تکنیک‌های شناختی-رفتاری می‌توانند کمک‌کننده باشند.",
                "تقریباً هر روز:  تقریباً تمام نگرانی‌های شما بیش از حد و غیرقابل کنترل هستند. این می‌تواند نشانه‌ای از اختلال اضطراب فراگیر باشد. **توصیه:**  درمان شناختی-رفتاری (CBT) و دارودرمانی تحت نظر پزشک متخصص می‌تواند به شما کمک کند."
            ]
        },
        {
            "text": "در این دو هفته، چقدر در آرام ماندن و استراحت مشکل داشتید؟",
            "options": ["اصلاً نداشتم", "چند روز در هفته", "بیشتر روزها", "تقریباً هر روز"],
            "messages": [
                "اصلاً نداشتم: شما به راحتی می‌توانید آرامش خود را حفظ کنید و استراحت کافی داشته باشید. **توصیه:**  به حفظ این توانایی و استفاده از آن در مواقع استرس‌زا ادامه دهید.",
                "چند روز در هفته: گاهی اوقات در آرام ماندن و استراحت مشکل دارید. **توصیه:**  پیش از خواب، یک برنامه روتین آرامش‌بخش برای خود ایجاد کنید (مانند مطالعه یا حمام آب گرم).",
                "بیشتر روزها:  شما اغلب برای آرامش و استراحت تلاش می‌کنید اما موفق نمی‌شوید. **توصیه:**  محیط خواب خود را آرام و مناسب‌سازی کنید. از مصرف کافئین و الکل قبل از خواب خودداری کنید.",
                "تقریباً هر روز:  به سختی می‌توانید آرام بگیرید و استراحت کنید. این بی‌قراری مداوم می‌تواند نشانه اضطراب باشد. **توصیه:**  اختلالات خواب ناشی از اضطراب را جدی بگیرید و از متخصص کمک بخواهید."
            ]
        },
        {
            "text": "در این دو هفته، چقدر بی‌قرار بودید و نمی‌توانستید آرام باشید؟",
            "options": ["اصلاً نداشتم", "چند روز در هفته", "بیشتر روزها", "تقریباً هر روز"],
            "messages": [
                "اصلاً نداشتم: شما به طور معمول احساس آرامش و سکون دارید. **توصیه:**  از این حس آرامش برای انجام فعالیت‌های لذت‌بخش و سازنده استفاده کنید.",
                "چند روز در هفته:  گاهی اوقات احساس بی‌قراری و ناآرامی دارید. **توصیه:**  فعالیت بدنی منظم می‌تواند به کاهش بی‌قراری و افزایش آرامش کمک کند.",
                "بیشتر روزها:  بیشتر اوقات احساس بی‌قراری و ناآرامی دارید و نمی‌توانید آرام بگیرید. **توصیه:**  تکنیک‌های تمرکز حواس (mindfulness) می‌توانند به شما در کاهش بی‌قراری و افزایش تمرکز کمک کنند.",
                "تقریباً هر روز:  بی‌قراری و ناآرامی تقریباً همیشه همراه شماست. این می‌تواند نشانه بارز اضطراب باشد. **توصیه:**  درمان‌های روانشناختی مانند CBT و ACT می‌توانند به شما در مدیریت بی‌قراری و اضطراب کمک کنند."
            ]
        },
        {
            "text": "در این دو هفته، چقدر زود عصبانی یا تحریک‌پذیر شدید؟",
            "options": ["اصلاً نداشتم", "چند روز در هفته", "بیشتر روزها", "تقریباً هر روز"],
            "messages": [
                "اصلاً نداشتم: شما به خوبی می‌توانید خشم و تحریک‌پذیری خود را کنترل کنید. **توصیه:**  حفظ آرامش و تمرکز بر واکنش‌های خود در موقعیت‌های مختلف را ادامه دهید.",
                "چند روز در هفته:  گاهی اوقات زود عصبانی یا تحریک‌پذیر می‌شوید. **توصیه:**  سعی کنید در این مواقع، قبل از واکنش نشان دادن، کمی مکث کنید و احساسات خود را مدیریت کنید.",
                "بیشتر روزها:  شما اغلب به سرعت عصبانی یا تحریک‌پذیر می‌شوید. **توصیه:**  به دنبال شناسایی محرک‌های خشم و یادگیری روش‌های کنترل خشم باشید. کلاس‌های مدیریت خشم می‌توانند مفید باشند.",
                "تقریباً هر روز:  تحریک‌پذیری و عصبانیت به طور مداوم در زندگی شما وجود دارد. این می‌تواند تاثیر منفی بر روابط شما داشته باشد. **توصیه:**  مشاوره فردی یا زوج‌درمانی می‌تواند به شما در بهبود مهارت‌های ارتباطی و مدیریت خشم کمک کند."
            ]
        },
        {
            "text": "در این دو هفته، چقدر احساس ترس داشتید که ممکن است اتفاق بدی بیفتد؟",
            "options": ["اصلاً نداشتم", "چند روز در هفته", "بیشتر روزها", "تقریباً هر روز"],
            "messages": [
                "اصلاً نداشتم: شما به طور معمول احساس امنیت و اطمینان دارید. **توصیه:**  به تقویت حس امنیت درونی خود ادامه دهید.",
                "چند روز در هفته: گاهی اوقات ترس از وقوع اتفاقات بد را تجربه می‌کنید. **توصیه:**  سعی کنید در این مواقع با یادآوری منابع و توانایی‌های خود، با ترس‌هایتان مقابله کنید.",
                "بیشتر روزها:  شما اغلب نگران وقوع اتفاقات بد هستید، حتی زمانی که دلیلی برای ترس وجود ندارد. **توصیه:**  به دنبال درمان شناختی رفتاری برای شناسایی و تغییر الگوهای فکری ترسناک باشید.",
                "تقریباً هر روز:  ترس از وقوع اتفاقات بد تقریباً همیشه با شماست و زندگی شما را تحت تاثیر قرار داده است. **توصیه:**  اختلالات اضطرابی که با ترس‌های شدید همراه هستند، قابل درمان هستند. حتما از متخصص کمک بگیرید."
            ]
        }
    ];

    const options = ["اصلاً نداشتم", "چند روز در هفته", "بیشتر روزها", "تقریباً هر روز"];
    const optionsKeys = Array.from({ length: options.length }, (_, i) => i); // کلید های گزینه ها: 0, 1, 2, 3


    const handleAnswerChange = (questionIndex, answerIndex) => {
        const newAnswers = [...answers];
        newAnswers[questionIndex] = answerIndex;
        setAnswers(newAnswers);
    };

    const calculateResult = () => {
        let totalScore = 0;
        const responseAnalysis = [];

        answers.forEach((answerIndex, questionIndex) => {
            if (answerIndex !== null) {
                const selectedOptionIndex = optionsKeys[answerIndex]; // اندیس گزینه انتخاب شده
                const question = questions[questionIndex];
                const score = answerIndex; // امتیاز هر گزینه با اندیس آن برابر است (0, 1, 2, 3)
                totalScore += score;


                responseAnalysis.push({
                    questionText: question.text,
                    selectedOption: options[selectedOptionIndex], // نمایش متن گزینه انتخاب شده
                    message: question.messages[selectedOptionIndex], // پیام مربوط به اندیس گزینه
                });
            }
        });


        const percentage = ((totalScore / 21) * 100).toFixed(2);

        let interpretation = "";
        if (totalScore <= 4) {
            interpretation = "حداقل اضطراب";
        } else if (totalScore <= 9) {
            interpretation = "اضطراب خفیف";
        } else if (totalScore <= 14) {
            interpretation = "اضطراب متوسط";
        } else {
            interpretation = "اضطراب شدید";
        }

        setTestResult({
            totalScore,
            percentage,
            interpretation,
            responseAnalysis
        });
        setShowResultAnalysis(true);
        onTestComplete && onTestComplete({ totalScore, percentage, interpretation, responseAnalysis });
    };

    return (
        <div className="test-container">
            <h2>📋 تست اضطراب GAD-7</h2>
            <p className="description">لطفاً به سوالات زیر با دقت پاسخ دهید. پاسخ‌ها مربوط به <b>۲ هفته گذشته</b> باشد.</p>

            {questions.map((question, questionIndex) => (
                <div key={questionIndex} className="question-box">
                    <p className="question-text">{question.text}</p>
                    <div className="options-container">
                        {options.map((option, optionIndex) => (
                            <label key={optionIndex} className="option-label">
                                <input
                                    type="radio"
                                    name={`question-${questionIndex}`}
                                    value={optionIndex}
                                    checked={answers[questionIndex] === optionIndex}
                                    onChange={() => handleAnswerChange(questionIndex, optionIndex)}
                                    className="option-input"
                                />
                                {option}
                            </label>
                        ))}
                    </div>
                </div>
            ))}

            <button
                onClick={calculateResult}
                disabled={answers.includes(null)}
                className="submit-button"
            >
                نمایش نتیجه تست
            </button>

            {showResultAnalysis && testResult && (
                <div className="result-analysis">
                    <h3>📊 تحلیل نتایج تست</h3>
                    <p><b>امتیاز کلی شما: {testResult.totalScore} از 21</b></p>
                    <p><b>درصد اضطراب: {testResult.percentage}%</b></p>
                    <p><b>سطح اضطراب:</b> {testResult.interpretation}</p>

                    <h4>🔍 تحلیل سوالات:</h4>
                    {testResult.responseAnalysis.map((analysis, index) => (
                        <div key={index} className="response-item">
                            <p><b>سوال {index + 1}:</b> {analysis.questionText}</p>
                            <p><b>گزینه انتخاب شده:</b> {analysis.selectedOption}</p>
                            <p className="message"><b>پیام تحلیل و راهکار:</b> {analysis.message}</p>
                        </div>
                    ))}
                </div>
            )}
        </div>
    );
};

AnxietyTestPage.propTypes = {
    onTestComplete: PropTypes.func.isRequired,
};

export default AnxietyTestPage;